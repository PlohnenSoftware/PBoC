---
title: "Analyzing a hematopoietic genetic network"
author: "Charbel Fadel, Ryan John and Krzysztof Zab≈Çocki"
date: "2024-06-03"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(BoolNet)
library(igraph)
library(openxlsx)

decimalToBinaryTable <- function(num) {
  # Initialize an empty vector for binary digits
  binary_vector <- integer()
  
  # Populate the vector with binary digits by dividing the number by 2
  while(num > 0) {
    binary_vector <- c(num %% 2, binary_vector)
    num <- num %/% 2
  }
  
  # Ensure the binary vector is always of length 11
  # If shorter, prefix with zeros
  if (length(binary_vector) < 11) {
    binary_vector <- c(rep(0, 11 - length(binary_vector)), binary_vector)
  }
  
  return(binary_vector)
}



# Load the network
HSC <- loadNetwork("hsc.txt")
```



```{r}
attr <- getAttractors(HSC)
plotStateGraph(attr)
print(attr)

```
Attractor 4 is the one that is closest to the experimental HSPC expression profile 11101111111 - 11100111111(Attractor 4)


```{r}
attr2 <- getAttractors(HSC, type="asynchronous",
method="random", startStates=500)
print(attr2)

# Write attractors to an Excel file
genes <- attr2$stateInfo$genes
fixedStates <- attr2$attractors[3][[1]]$involvedStates
fixedStates <- sapply(fixedStates, decimalToBinaryTable)
genes_df <- setNames(data.frame(t(fixedStates)), genes)

# Reverse the rows if they are in reverse order
genes_df <- genes_df[nrow(genes_df):1, ]

# Optionally reverse the columns if they are in reverse order
genes_df <- genes_df[, ncol(genes_df):1]

print(str(genes_df))
write.xlsx(genes_df, "Attractors_Output.xlsx", sheetName = "InvolvedStates")
```


Task 2 : Attractor 3 appears to be an assynchronous attractor because it is a complex/loose attractor

Task 3 : The average expression per gene for the 12 individual cells is:


 Eto2: 0.33   
 Fli1: 0.25      
 Gata1: 0.00    
 Gata2: 0.04     
 Hhex: 0.50  
 Pu.1: 0.33    
 Runx1: 0.08    
 Scl: 0.67    
 Smad6: 0.13    
 Zfpm1: 0.42    

and the avg activity per gene across the 32 states IS :
Erg :  0.5	
Eto2:  0.5	
Fli1:  1	
Gata1: 0	
Gata2: 0.5	
Hhex:  1	
Pu.1:  1	
Runx1: 0.5	
Scl:   1	
Smad6: 1	
Zfpm1: 0.5

We concluded that the avg activities per gene were not similar except for the Gata1.



```{r}
pdf("RBNs.pdf")
for(i in 1:10){ #initiating a loop
net<-generateRandomNKNetwork(n=10, k=i) # generating random networks with n=10 genes and each gene having from 1-10 ibput genes
plotNetworkWiring(net, main=i) #Plotting the network with title i
attr <- getAttractors(net) # getting the number of attractors and attributing it to the variable attr
plotStateGraph(attr, main=i) #plotting the attractors with i being the title
}
dev.off("RBNs.pdf") # closes the pdf directly when it opens
```


```{r}
pdf("Pertubations.pdf")
data(cellcycle)
attr <- getAttractors(cellcycle)
plotStateGraph(attr, main="Unperturbed network")
for(i in 1:5){
perturbedNet <- perturbNetwork(cellcycle, perturb="functions", method="bitflip")
attr <- getAttractors(perturbedNet)
plotStateGraph(attr, main=i)
}
dev.off("Perturbations.pdf")
```

